# Ch14 CRUD Operation

- `apiRequest.json`
- CRUD 요청 실행
- localStorage 삭제

`fetch` 함수의 두번째 argument가 CRUD의 종류를 결정한다.

어플리케이션에선: State로 표시
`apiRequest.js` 속 `apiRequest` 함수 => only API 요청

## 문제: JSON-Server id 

JSON Server가 id를 string으로 저장한다.

`...items/<id>` => `{ ... id: "<id>" }`

이는 JSON Server가 업데이트 되면서 생긴 문제로 보인다

[관련 Github Issue](https://github.com/typicode/json-server/issues/1510)

이상 현상: id가 `1, 2, 3, "4", "41"`로 저장됨

### 대안

id를 string으로 쓰기로 했다

```js
// 새 아이디 생성
const id = items.length === 0 ? 
    "1" : 
    (parseInt(items[items.length - 1].id) + 1).toString();
```

## POST

```js
/**
 * @type {RequestInit}
 */
const postOptions = {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify(newItem),
}
const result = await apiRequest(API_URL, postOptions);
if (result) // If error exists
    setFetchError(result)
```

## PATCH

```js
// const myItem = items.find((item) => item.id === id);
    // 오답노트 240330
    // items X | listItems O
    // set되기 이전 변수 사용 X
    // 이상 현상: checked value가 반대로(변경 전 값으로) API에 저장됨
const myItem = listItems.find((item) => item.id === id);
/**
 * @type {RequestInit}
 */
const postOptions = {
    method: "PATCH",
    headers: {
    "Content-type": "application/json",
    },
    body: JSON.stringify({checked: myItem.checked}),
}
const reqUrl = `${API_URL}/${id}` // !!!
const result = await apiRequest(reqUrl, postOptions);
if (result) // If error exists
    setFetchError(result)
```

## DELETE

```js
// API DELETE

/**
 * @type {RequestInit}
 */
const postOptions = {
    method: "DELETE",
}
const reqUrl = `${API_URL}/${id}` // !!!
const result = await apiRequest(reqUrl, postOptions);
if (result) // If error exists
    setFetchError(result)
```

## Codespace `devcontainer.json 수정`

`devcontainer.json` 수정 후 `Ctrl-Shift-P` 후 `Rebuild` 어쩌구를 실행해 주어야 한다.
